[Unit]
Description=Auto-Deploy Trigger
Requires=hab-supervisor.service
# can only be called by auto-deploy.timer
RefuseManualStart=true
After=network.target

[Service]
Type=oneshot
# if taking longer than 5 minutes let it fail
ExecStartPre=/usr/bin/timeout 300s /bin/bash /run/bootstrap.sh
ExecStart=/usr/bin/curl \
  -sH "Content-Type: application/json" \
  -d '{"trigger":"{{ eda_rulebook | default("eda_vms")}}"}' \
  http://127.0.0.1:33337/endpoint

[Install]
WantedBy=multi-user.target
